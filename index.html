function doGet(e) {
  return ContentService.createTextOutput("Web App is running").setMimeType(ContentService.MimeType.TEXT);
}

function doPost(e) {
  try {
    if (!e || !e.postData || !e.postData.contents) {
      return ContentService.createTextOutput(JSON.stringify({ status: "error", message: "No data received" }))
             .setMimeType(ContentService.MimeType.JSON);
    }

    var data = JSON.parse(e.postData.contents);
    if (!data.email || !validateEmail(data.email)) {
      return ContentService.createTextOutput(JSON.stringify({ status: "error", message: "Invalid email" }))
             .setMimeType(ContentService.MimeType.JSON);
    }

    var sheet = SpreadsheetApp.openById("1FQZgBanevy2x-ut_YZhrwt1koIYQlIKqWvxaPUJV-Y0").getActiveSheet();
    sheet.appendRow([data.email, new Date()]); // Add timestamp

    var response = {
      status: "success",
      message: "Email saved successfully"
    };

    return ContentService.createTextOutput(JSON.stringify(response))
           .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    var errorResponse = {
      status: "error",
      message: error.toString()
    };

    return ContentService.createTextOutput(JSON.stringify(errorResponse))
           .setMimeType(ContentService.MimeType.JSON);
  }
}

function validateEmail(email) {
  var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}
